version: '3.8'

services:
  kettle:
    image: kettle-launcher:latest
    container_name: kettle-launcher
    environment:
      # Option 1: Use environment variable for manifest URL (recommended for Dstack)
      # Set this to a URL or file path
      - KETTLE_MANIFEST=${KETTLE_MANIFEST:-}
      
      # Option 2: Use port (default: 3001)
      - KETTLE_PORT=${KETTLE_PORT:-3001}
      
      # Option 3: Database directory (default: /data)
      - KETTLE_DB_DIR=${KETTLE_DB_DIR:-/data}
      
      # Option 4: Verbose logging (optional)
      - KETTLE_VERBOSE=${KETTLE_VERBOSE:-}
    volumes:
      # Option: Mount external manifest file instead of using env var
      # Uncomment the line below and comment out KETTLE_MANIFEST to use mounted file
      # - ./manifests/my-manifest.json:/app/manifest.json:ro
      
      # Mount persistent data directory (optional, but recommended)
      - kettle-data:/data
    ports:
      - "${KETTLE_PORT:-3001}:${KETTLE_PORT:-3001}"
    restart: unless-stopped
    # Optional: Add resource limits
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G

volumes:
  kettle-data:
    driver: local

