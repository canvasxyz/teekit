[Build]
WithNetwork=true
# SGX repository configuration - copy to build sandbox for apt access
SandboxTrees=kettle-vm-sgx/mkosi.sandbox

[Content]
# Also copy to target image skeleton
SkeletonTrees=kettle-vm-sgx/mkosi.skeleton

# Build-time packages needed for enclave signing
BuildPackages=gramine
              zstd
              nodejs
              npm
              curl
              gnupg

BuildScripts=kettle-vm-sgx/mkosi.build

# SGX runtime packages (from Intel SGX and Gramine repos)
Packages=nodejs
         npm
         nginx
         certbot
         python3-certbot-nginx
         xxd
         zstd
         lsof
         # SGX packages (from Intel SGX APT repo)
         libsgx-launch
         libsgx-enclave-common
         libsgx-dcap-ql
         libsgx-dcap-default-qpl
         libsgx-quote-ex
         libsgx-urts
         sgx-aesm-service
         # Gramine runtime (from Gramine APT repo)
         gramine
         # vTPM attestation tools
         tpm2-tools
PostInstallationScripts=kettle-vm-sgx/mkosi.postinst
