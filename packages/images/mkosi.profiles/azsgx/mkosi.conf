[Output]
ImageId=kettle-vm-azsgx

[Build]
WithNetwork=true
Environment=SGX=1
Environment=LOG_LEVEL=error
# Microsoft repository configuration - copy to build sandbox for apt access
SandboxTrees=mkosi.sandbox

[Content]
# Azure provisioning shim
SkeletonTrees=../azure/azure-complete-provisioning.service:/etc/systemd/system/azure-complete-provisioning.service
SkeletonTrees=../azure/azure-complete-provisioning:/usr/bin/azure-complete-provisioning
# Microsoft APT repo for az-dcap-client
SkeletonTrees=mkosi.skeleton

# Azure-specific packages
Packages=dmidecode
         build-essential
         # Azure DCAP client for SGX attestation on Azure
         az-dcap-client

PostInstallationScripts=mkosi.postinst
