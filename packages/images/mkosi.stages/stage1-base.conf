# Stage 1: Minimal base image only (no kernel)
# This is the simplest build to identify base system inconsistencies

[Distribution]
Architecture=x86-64
Distribution=debian
Release=trixie
# Pin to Debian snapshot for reproducible builds (2025-05-20)
Mirror=https://snapshot.debian.org/archive/debian/20250520T000000Z/

[Build]
PackageCacheDirectory=mkosi.cache
WithNetwork=true

[Output]
Format=directory
ManifestFormat=json
ImageId=tdx-debian-stage1
OutputDirectory=build
Seed=630b5f72-a36a-4e83-b23d-6ef47c82fd9c

[Content]
# SourceDateEpoch will use SOURCE_DATE_EPOCH environment variable if set
SkeletonTrees=base/mkosi.skeleton
PrepareScripts=base/fix-sysusers-tmpfiles.sh
FinalizeScripts=base/debloat.sh
FinalizeScripts=base/normalize-timestamps.sh
PostInstallationScripts=base/debloat-systemd.sh

CleanPackageMetadata=true
Packages=kmod
         systemd
         systemd-boot-efi
         busybox
         util-linux
         procps
         ca-certificates
         openssl
         iproute2
         udhcpc
         e2fsprogs
